<winex:WindowEx
    x:Class="TeacherToolbox.Controls.TimerWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="using:TeacherToolbox.Helpers"
    xmlns:local="using:TeacherToolbox.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:winex="using:WinUIEx"
    mc:Ignorable="d">

    <Grid
        PointerMoved="Grid_PointerMoved"
        PointerPressed="Grid_PointerPressed"
        PointerReleased="Grid_PointerReleased"
        Tapped="Grid_Tapped">

        <Grid>
            <!--  Outer Grid for proportional sizing  -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="2*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="2*" />
                    <RowDefinition Height="4*" />
                    <RowDefinition Height="2*" />
                </Grid.RowDefinitions>

                <!--  Timer Gauge fills the entire grid  -->
                <Viewbox
                    Grid.RowSpan="3"
                    Grid.ColumnSpan="3"
                    Visibility="{Binding ElementName=timerGauge, Path=Visibility}">
                    <controls:RadialGauge
                        x:Name="timerGauge"
                        x:FieldModifier="public"
                        MaxAngle="360"
                        MinAngle="0"
                        NeedleBrush="Transparent"
                        NeedleLength="70"
                        NeedleWidth="0"
                        ScaleBrush="Transparent"
                        ScalePadding="0"
                        ScaleTickBrush="Transparent"
                        ScaleWidth="20"
                        StepSize="1"
                        TickLength="20"
                        TickSpacing="5"
                        TickWidth="2"
                        TrailBrush="{StaticResource darkPurpleBrush}"
                        ValueStringFormat="'" />
                </Viewbox>

                <!--  Timer Text centered in the middle cell, naturally scales with window size  -->
                <Viewbox
                    Grid.Row="1"
                    Grid.Column="1"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="{Binding ElementName=timerGauge, Path=Visibility}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock
                            x:Name="timerText"
                            FontFamily="Cascadia Mono, Courier New, monospace"
                            FontSize="60"
                            FontStretch="Normal"
                            FontWeight="SemiBold"
                            TextAlignment="Center" />

                        <TextBlock
                            x:Name="intervalInfoText"
                            Margin="0,5,0,0"
                            HorizontalAlignment="Center"
                            FontSize="20"
                            FontWeight="Normal" />
                    </StackPanel>
                </Viewbox>
            </Grid>

            <!--  Timer Setup UI  -->
            <Grid
                x:Name="timeSelector"
                Margin="0"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Intervals List with Header Labels  -->
                <Grid Grid.Row="0" Margin="4,4,4,2">
                    <!--  Column Headers  -->
                    <Grid
                        Height="16"
                        Margin="30,0,20,0"
                        VerticalAlignment="Top">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Grid.Column="0"
                            HorizontalAlignment="Center"
                            FontSize="10"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="h" />

                        <TextBlock
                            Grid.Column="2"
                            HorizontalAlignment="Center"
                            FontSize="10"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="m" />

                        <TextBlock
                            Grid.Column="4"
                            HorizontalAlignment="Center"
                            FontSize="10"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="s" />
                    </Grid>

                    <!--  Intervals ListView  -->
                    <ListView
                        x:Name="intervalsListView"
                        Margin="0,16,0,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Center"
                        IsItemClickEnabled="False"
                        SelectionMode="None">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                <Setter Property="VerticalContentAlignment" Value="Center" />
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Margin" Value="0,1" />
                                <!--  Reduced from 4 to 1  -->
                                <Setter Property="MinHeight" Value="28" />
                                <!--  Ensure consistent height  -->
                                <Setter Property="Background" Value="Transparent" />
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid
                                    Padding="2"
                                    VerticalAlignment="Center"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Interval Number  -->
                                    <TextBlock
                                        Grid.Column="0"
                                        Margin="2,0,4,0"
                                        VerticalAlignment="Center"
                                        FontSize="12"
                                        FontWeight="SemiBold"
                                        Text="{Binding IntervalNumber}" />

                                    <!--  Time Fields without labels  -->
                                    <Grid
                                        Grid.Column="1"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  Hours  -->
                                        <TextBox
                                            Grid.Column="0"
                                            MinHeight="22"
                                            Padding="2,0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            BorderThickness="1"
                                            FontSize="12"
                                            Text="{Binding Hours, Mode=TwoWay}"
                                            TextAlignment="Center" />

                                        <TextBlock
                                            Grid.Column="1"
                                            Margin="1,0"
                                            VerticalAlignment="Center"
                                            FontSize="12"
                                            FontWeight="Bold"
                                            Text=":" />

                                        <!--  Minutes  -->
                                        <TextBox
                                            Grid.Column="2"
                                            MinHeight="22"
                                            Padding="2,0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            BorderThickness="1"
                                            FontSize="12"
                                            Text="{Binding Minutes, Mode=TwoWay}"
                                            TextAlignment="Center" />

                                        <TextBlock
                                            Grid.Column="3"
                                            Margin="1,0"
                                            VerticalAlignment="Center"
                                            FontSize="12"
                                            FontWeight="Bold"
                                            Text=":" />

                                        <!--  Seconds  -->
                                        <TextBox
                                            Grid.Column="4"
                                            MinHeight="22"
                                            Padding="2,0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            BorderThickness="1"
                                            FontSize="12"
                                            Text="{Binding Seconds, Mode=TwoWay}"
                                            TextAlignment="Center" />
                                    </Grid>

                                    <!--  Remove Button  -->
                                    <Button
                                        Grid.Column="2"
                                        Width="20"
                                        Height="20"
                                        Margin="2,0,0,0"
                                        Padding="0"
                                        VerticalAlignment="Center"
                                        Click="RemoveInterval_Click"
                                        Visibility="{Binding ShowRemoveButton, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <FontIcon FontSize="8" Glyph="&#xE711;" />
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <!--  Action Buttons  -->
                <StackPanel Grid.Row="1" Margin="4,2,4,4">
                    <Button
                        x:Name="addIntervalButton"
                        Height="32"
                        Margin="0,2,0,4"
                        HorizontalAlignment="Stretch"
                        Click="AddIntervalButton_Click"
                        Style="{StaticResource AccentButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <FontIcon
                                Margin="0,0,4,0"
                                FontSize="10"
                                Glyph="&#xE710;" />
                            <TextBlock
                                FontSize="12"
                                FontWeight="SemiBold"
                                Text="Add Interval" />
                        </StackPanel>
                    </Button>

                    <Button
                        x:Name="startButton"
                        Height="40"
                        HorizontalAlignment="Stretch"
                        Click="StartButton_Click"
                        Style="{StaticResource AccentButtonStyle}">
                        <TextBlock
                            FontSize="14"
                            FontWeight="SemiBold"
                            Text="Start Timer" />
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</winex:WindowEx>